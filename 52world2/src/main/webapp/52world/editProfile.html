<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>프로필 수정</title>
</head>
<body>
	<form name="profileForm" action="../profile.do" method="post"
		enctype="multipart/form-data">
		<h3>사진 변경</h3>
		<img id="profile-img" /> <input type="file" name="img" id="img"
			accept="image/*" onchange="preview(this)" /><br />
		<h3>자기 소개</h3>
		<textarea name="introduce" id="introduce" cols="30" rows="10"></textarea>
		<br /> <input type="submit" value="저장" onclick="profileFormSubmit()" />
		<button onclick="cancle()">취소</button>
	</form>
	<script>
		let search = window.location.search
		let params = new URLSearchParams(search);
		let getSrc = params.get('src');
		console.log(getSrc);
		let index = getSrc.indexOf("/52");
		getSrc = getSrc.substring(index);

		document.querySelector("#profile-img").src = getSrc;
		document.querySelector('#profile-img').width = 200;
		document.querySelector('#profile-img').height = 200;
		function preview(input) {
			if (input.files && input.files[0]) {
				var reader = new FileReader();
				reader.onload = function(e) {
					document.querySelector("#profile-img").src = e.target.result;
					document.querySelector('#profile-img').width = 200;
					document.querySelector('#profile-img').height = 200;
				};
				reader.readAsDataURL(input.files[0]);
			} else {
				document.getElementById('preview').src = "";
			}

		}
		function cancle() {
			window.close();
		}

		function profileFormSubmit() {
			window.opener.name = "parentPage"; // 부모창의 이름 설정
			document.profileForm.target = "parentPage"; // 타켓을 부모창으로 설정
			document.profileForm.action = "../profile.do"; //부모창에 호출될 url 
			document.profileForm.submit();
			opener.parent.location.reload();
			self.close();
		}
	</script>
</body>
</html>